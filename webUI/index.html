<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Retreivr</title>
  <link rel="icon" href="app_icon.png" type="image/png">
  <link rel="apple-touch-icon" href="app_icon.png">
  <link rel="stylesheet" href="styles.css?v=0.9.2-homefix">
  <script defer src="app.js?v=0.9.2-homefix"></script>
</head>
<body>
  <div class="backdrop"></div>
  <header class="topbar">
    <div class="brand">
      <img class="app-icon" src="app_icon.png" alt="Retreivr">
      <div class="brand-text">
        <div class="title">Retreivr</div>
        <div class="subtitle">Self-hosted playlist archiving</div>
      </div>
    </div>
    <button id="nav-toggle" class="button ghost small nav-toggle" type="button" aria-expanded="false" aria-controls="primary-nav">
      Menu
    </button>
    <nav class="top-nav" id="primary-nav" aria-label="Primary">
      <button class="button ghost small nav-button" data-page="home" type="button">Home</button>
      <button class="button ghost small nav-button" data-page="advanced" type="button">Advanced Search</button>
      <button class="button ghost small nav-button" data-page="status" type="button">Status</button>
      <button class="button ghost small nav-button" data-page="config" type="button">Config</button>
      <div id="nav-actions" class="nav-actions"></div>
    </nav>
    <div class="top-actions" id="top-actions">
      <button id="refresh-all" class="button">Refresh</button>
      <button id="toggle-theme" class="button ghost">Light mode</button>
      <a class="button ghost" href="/docs" target="_blank" rel="noopener">OpenAPI</a>
    </div>
  </header>

  <main class="layout">
    <section class="panel full page-full" id="home-panel" data-page="home">
      <div class="home-search-shell">
        <div class="music-mode-toggle-row">
          <label class="music-mode-switch" for="music-mode-toggle">
            <input id="music-mode-toggle" type="checkbox">
            <span class="music-mode-slider" aria-hidden="true"></span>
            <span class="music-mode-label">Music Mode</span>
          </label>
        </div>
        <div id="standard-search-container">
          <input
            id="home-search-input"
            class="home-search-input"
            type="text"
            placeholder="Search YouTube, music, podcasts, archives…"
            autocomplete="off"
          />

          <div class="home-search-toggles">
            <div id="home-source-filters" class="home-source-filters">
              <button
                id="home-source-toggle"
                class="home-source-toggle"
                type="button"
                aria-expanded="false"
                aria-controls="home-source-panel"
              >
                Sources: All
              </button>
              <div id="home-source-panel" class="home-source-panel" role="menu">
                <label class="home-source-pill"><input type="checkbox" data-source="youtube" checked> <span>YouTube</span></label>
                <label class="home-source-pill"><input type="checkbox" data-source="youtube_music" checked> <span>YouTube Music</span></label>
                <label class="home-source-pill"><input type="checkbox" data-source="soundcloud" checked> <span>SoundCloud</span></label>
                <label class="home-source-pill"><input type="checkbox" data-source="bandcamp" checked> <span>Bandcamp</span></label>
              </div>
            </div>

            <button
              id="home-advanced-toggle"
              class="button ghost small home-advanced-toggle"
              type="button"
              aria-expanded="false"
              aria-controls="home-advanced-panel"
            >
              Advanced options
            </button>
          </div>

          <div id="home-advanced-panel" class="home-advanced-panel hidden">
            <div class="home-advanced-row">
              <label class="home-advanced-field">
                <span>Format</span>
                <select id="home-format">
                  <option value="">Default</option>
                  <option value="mp3">mp3</option>
                  <option value="mp4">mp4</option>
                  <option value="mkv">mkv</option>
                  <option value="webm">webm</option>
                </select>
              </label>

              <label class="home-advanced-field">
                <span>Destination</span>
                <div class="row">
                  <input id="home-destination" type="text" placeholder="downloads">
                  <button id="home-destination-browse" class="button ghost small" type="button">Browse</button>
                </div>
              </label>
            </div>
          </div>

          <div class="home-search-actions">
            <button id="home-search-only" class="button primary">Search</button>
            <button id="home-search-download" class="button ghost">Search &amp; Download</button>
          </div>
        </div>

        <div id="music-mode-console" class="hidden">
          <section class="panel">
            <div class="panel-title">Music Search</div>
            <div class="stack">
              <div class="group">
                <div class="group-title">Create Search Request</div>
                <div class="grid two">
                  <label class="field medium">
                    <span>Artist</span>
                    <input id="search-artist" type="text" placeholder="Artist name">
                  </label>
                  <label class="field medium">
                    <span>Album</span>
                    <input id="search-album" type="text" placeholder="Optional album">
                  </label>
                  <label class="field medium">
                    <span>Track</span>
                    <input id="search-track" type="text" placeholder="Optional track">
                  </label>
                  <label class="field short">
                    <span>Mode</span>
                    <select id="music-mode-select">
                      <option value="auto">Auto</option>
                      <option value="artist">Artist</option>
                      <option value="album">Album</option>
                      <option value="track">Track</option>
                    </select>
                  </label>
                  <label class="field short">
                    <span>Max candidates (1-15)</span>
                    <input id="search-max-candidates" type="number" min="1" max="15" value="5">
                  </label>
                </div>
                <div class="row">
                  <div class="action-group">
                    <button id="search-create-only" class="button">Search</button>
                  </div>
                  <div id="search-create-message" class="notice" role="status"></div>
                </div>
              </div>
            </div>
          </section>
        </div>
        <div id="music-results-container"></div>

        <button id="import-playlist-toggle" class="button ghost small" type="button">Import Playlist</button>
        <div id="import-playlist-panel" class="hidden">
          <div class="home-advanced-row">
            <label class="home-advanced-field">
              <span>Import playlist file</span>
              <input id="home-import-file" type="file" accept=".m3u,.m3u8,.csv,.xml,.plist,.json">
            </label>
            <button id="home-import-button" class="button ghost small" type="button">Import Playlist</button>
          </div>
          <div id="home-import-summary" class="meta"></div>
        </div>

        <div id="home-search-message" class="notice" role="status">
          Press Enter or click Search to discover media
        </div>
      </div>
      <div class="home-results hidden" id="home-results">
        <div class="home-results-header">
          <span>Results</span>
          <div class="home-results-header-actions">
            <span id="home-results-status-text" class="meta">Ready to discover media</span>
          </div>
        </div>
        <div class="home-results-progress" id="home-results-progress">Searching…</div>
        <div id="home-results-detail" class="meta home-results-detail hidden"></div>
        <div id="home-results-list"></div>
      </div>
    </section>
    <section class="panel" id="status-panel" data-page="status">
      <div class="panel-title">Status</div>
      <div class="stack">
        <div class="row">
          <span class="chip" id="status-running">idle</span>
          <span class="meta" id="status-run-id">run: -</span>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Started</span>
            <span id="status-started">-</span>
          </div>
          <div class="stat">
            <span class="label">Finished</span>
            <span id="status-finished">-</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Success</span>
            <span id="status-success">0</span>
          </div>
          <div class="stat">
            <span class="label">Failed</span>
            <span id="status-failed">0</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Watcher</span>
            <span id="status-watcher">-</span>
          </div>
          <div class="stat">
            <span class="label">Scheduler</span>
            <span id="status-scheduler">-</span>
          </div>
        </div>
        <div class="group">
          <div class="group-title">Watcher Status</div>
          <div class="row">
            <div class="stat">
              <span class="label">State</span>
              <span id="watcher-state">-</span>
            </div>
            <div class="stat">
              <span class="label">Pending playlists</span>
              <span id="watcher-pending">0</span>
            </div>
            <div class="stat">
              <span class="label">Batch mode</span>
              <span id="watcher-batch">-</span>
            </div>
          </div>
          <div class="row">
            <div class="stat">
              <span class="label">Last playlist check</span>
              <span id="watcher-last-poll">-</span>
            </div>
            <div class="stat">
              <span class="label">Next playlist check</span>
              <span id="watcher-next-poll">-</span>
            </div>
          </div>
          <div class="row">
            <div class="stat">
              <span class="label">Quiet window remaining</span>
              <span id="watcher-quiet-remaining">-</span>
            </div>
          </div>
        </div>
        <div class="group">
          <div class="group-title">Spotify Sync Status</div>
          <div class="row">
            <div class="stat">
              <span class="label">OAuth</span>
              <span id="spotify-status-oauth">-</span>
            </div>
            <div class="stat">
              <span class="label">Last Liked Songs Sync</span>
              <span id="spotify-status-liked">-</span>
            </div>
          </div>
          <div class="row">
            <div class="stat">
              <span class="label">Last Saved Albums Sync</span>
              <span id="spotify-status-saved">-</span>
            </div>
            <div class="stat">
              <span class="label">Last Playlists Sync</span>
              <span id="spotify-status-playlists">-</span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Active playlist</span>
            <span id="status-playlist">-</span>
          </div>
          <div class="stat">
            <span class="label">Active video</span>
            <span id="status-video">-</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Phase</span>
            <span id="status-phase">-</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Last completed</span>
            <span id="status-last-completed">-</span>
          </div>
          <div class="stat">
            <span class="label">Playlist progress</span>
            <span id="status-playlist-progress-text">-</span>
          </div>
        </div>
        <div class="progress">
          <div id="status-playlist-progress-bar" class="progress-bar"></div>
        </div>
        <div id="status-video-progress" class="stack hidden">
          <div class="row">
            <div class="stat">
              <span class="label">Video progress</span>
              <span id="status-video-progress-text">-</span>
            </div>
            <span id="status-video-progress-meta" class="meta">-</span>
          </div>
          <div class="progress">
            <div id="status-video-progress-bar" class="progress-bar"></div>
          </div>
        </div>
        <div class="row">
          <span class="label">Last error</span>
          <span id="status-error" class="meta">-</span>
        </div>
        <div class="group">
          <div class="group-title">Music failures</div>
          <div class="row">
            <div class="stat">
              <span class="label">Count</span>
              <span id="music-failures-count">0</span>
            </div>
            <button id="music-failures-refresh" class="button ghost small" type="button">Refresh</button>
          </div>
          <div id="music-failures-list" class="stack"></div>
        </div>
        <div class="row">
          <button id="status-cancel" class="button remove small" type="button">Kill downloads in progress</button>
        </div>
      </div>
    </section>

    <section class="panel" id="metrics-panel" data-page="status">
      <div class="panel-title">Metrics</div>
      <div class="panel-body">
        <div class="row">
          <div class="stat">
            <span class="label">Downloads files</span>
            <span id="metrics-downloads-count">-</span>
          </div>
          <div class="stat">
            <span class="label">Downloads size</span>
            <span id="metrics-downloads-size">-</span>
          </div>
          <div class="stat">
            <span class="label">Disk free</span>
            <span id="metrics-disk-free">-</span>
          </div>
          <div class="stat">
            <span class="label">Disk total</span>
            <span id="metrics-disk-total">-</span>
          </div>
        </div>
        <div class="row">
          <span id="metrics-message" class="notice"></span>
        </div>
      </div>
      <div class="panel-footer">
        <div class="row version-block">
          <div class="stat">
            <span class="label">Version</span>
            <div class="meta">
              <div id="status-version-app">App -</div>
              <div id="status-version-ytdlp">yt-dlp -</div>
              <div id="status-version-python">Py -</div>
            </div>
          </div>
          <div class="stat">
            <span class="label">Update</span>
            <span id="status-update" class="meta">-</span>
          </div>
        </div>
      </div>
    </section>

    <section class="panel full" id="config-panel" data-page="config">
      <div class="panel-title">Config Editor</div>
      <div class="stack">
        <div class="group">
          <div class="group-title">Config File</div>
          <div class="row">
            <label class="field long">
              <span>Config path (server)</span>
              <input id="config-path" type="text" placeholder="config/config.json">
            </label>
            <button id="browse-config-path" class="button ghost">Browse</button>
            <button id="load-config-path" class="button">Load</button>
          </div>
          <div class="notice">Path changes apply globally on the server.</div>
        </div>

        <div class="group">
          <div class="group-title">General</div>
          <div class="grid two">
            <label class="field short">
              <span>Upload date format</span>
              <input id="cfg-upload-date-format" type="text" placeholder="MM-YYYY">
            </label>
            <label class="field full">
              <span>Filename template</span>
              <input id="cfg-filename-template" type="text" placeholder="%(title)s - %(uploader)s - %(upload_date)s.%(ext)s">
            </label>
            <label class="field short">
              <span>Final format</span>
              <select id="cfg-final-format">
                <option value="">(not set)</option>
                <option value="mkv">mkv (default)</option>
                <option value="mp4">mp4</option>
                <option value="webm">webm</option>
                <option value="mp3">mp3</option>
              </select>
            </label>
            <div class="notice">Final format currently applies to video output; music uses <code>music_final_format</code> from config.json.</div>
            <label class="field medium">
              <span>JS runtime</span>
              <input id="cfg-js-runtime" type="text" placeholder="node:/usr/bin/node">
            </label>
            <label class="field medium">
              <span>Single download folder</span>
              <div class="row">
                <input id="cfg-single-download-folder" type="text" placeholder="downloads">
                <button id="browse-single-download" class="button ghost small">Browse</button>
              </div>
            </label>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Watcher</div>
          <div class="grid two">
            <label class="field inline short">
              <span>Enabled</span>
              <input id="cfg-watcher-enabled" type="checkbox">
            </label>
            <label class="field short">
              <span>Min interval (minutes)</span>
              <input id="cfg-watcher-min-interval" type="number" min="1" step="1">
            </label>
            <label class="field short">
              <span>Max interval (minutes)</span>
              <input id="cfg-watcher-max-interval" type="number" min="1" step="1">
            </label>
            <label class="field short">
              <span>Idle backoff factor</span>
              <input id="cfg-watcher-idle-backoff" type="number" min="1" step="1">
            </label>
            <label class="field short">
              <span>Active reset (minutes)</span>
              <input id="cfg-watcher-active-reset" type="number" min="1" step="1">
            </label>
            <label class="field inline short">
              <span>Downtime enabled</span>
              <input id="cfg-watcher-downtime-enabled" type="checkbox">
            </label>
            <label class="field short">
              <span>Downtime start (HH:MM)</span>
              <input id="cfg-watcher-downtime-start" type="text" placeholder="23:00">
            </label>
            <label class="field short">
              <span>Downtime end (HH:MM)</span>
              <input id="cfg-watcher-downtime-end" type="text" placeholder="09:00">
            </label>
            <label class="field medium">
              <span>Downtime timezone</span>
              <input id="cfg-watcher-downtime-timezone" type="text" placeholder="local">
            </label>
          </div>
        <div class="notice">Automatically monitors playlists and downloads new videos as they appear.</div>
      </div>

      <div class="group">
        <div class="group-title">Scheduler</div>
        <div class="row">
          <label class="field inline">
            <span>Enabled</span>
            <input id="schedule-enabled" type="checkbox">
          </label>
          <label class="field inline short">
            <span>Interval (hours)</span>
            <input id="schedule-interval" type="number" min="1" step="1" value="6">
          </label>
          <label class="field inline">
            <span>Run on startup</span>
            <input id="schedule-startup" type="checkbox">
          </label>
        </div>
        <div class="row">
          <button id="schedule-save" class="button">Save Schedule</button>
          <button id="schedule-run-now" class="button ghost">Run now</button>
        </div>
        <div class="row">
          <div id="schedule-message" class="notice" role="status"></div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Last run</span>
            <span id="schedule-last-run">-</span>
          </div>
          <div class="stat">
            <span class="label">Next run</span>
            <span id="schedule-next-run">-</span>
          </div>
        </div>
        <div class="notice">Runs full playlist jobs on a fixed interval. Not required when watcher is enabled.</div>
        <div id="schedule-watcher-note" class="notice" style="display: none;">Watcher is active. Scheduler is optional and usually unnecessary.</div>
        <div class="notice">Scheduled runs will not interrupt or overlap manual runs.</div>
      </div>

        <div class="group">
          <div class="group-title">Telegram</div>
          <div class="grid two">
            <label class="field long">
              <span>Bot token</span>
              <div class="row">
                <input id="cfg-telegram-token" type="password">
                <button id="toggle-telegram-token" class="button ghost small" type="button">Show</button>
              </div>
            </label>
            <label class="field short">
              <span>Chat ID</span>
              <input id="cfg-telegram-chat" type="text">
            </label>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Music</div>
          <div class="grid two">
            <label class="field full">
              <span>Music filename template</span>
              <input id="cfg-music-template" type="text" placeholder="%(artist)s/%(album)s/%(track_number)s - %(track)s.%(ext)s">
            </label>
            <label class="field long">
              <span>yt-dlp cookies (optional)</span>
              <div class="row">
                <input id="cfg-yt-dlp-cookies" type="text" placeholder="tokens/cookies.txt">
                <button id="browse-yt-dlp-cookies" class="button ghost small" type="button">Browse</button>
              </div>
            </label>
          </div>
          <div class="notice">Cookies are optional but strongly recommended for YouTube Music metadata.</div>
        </div>

        <div class="group">
          <div class="group-title">Music metadata enrichment</div>
          <div class="grid two">
            <label class="field short">
              <span>Music mode match threshold (%)</span>
              <input id="cfg-music-meta-threshold" type="number" min="0" max="100" step="1">
            </label>
            <label class="field inline short">
              <span>Enabled</span>
              <input id="cfg-music-meta-enabled" type="checkbox">
            </label>
            <label class="field short">
              <span>Enrichment confidence threshold (%)</span>
              <input id="cfg-music-enrich-threshold" type="number" min="0" max="100" step="1">
            </label>
            <label class="field inline short">
              <span>Use AcoustID</span>
              <input id="cfg-music-meta-acoustid" type="checkbox">
            </label>
            <label class="field long">
              <span>AcoustID API key</span>
              <input id="cfg-music-meta-acoustid-key" type="password" placeholder="optional">
            </label>
            <label class="field inline short">
              <span>Embed artwork</span>
              <input id="cfg-music-meta-artwork" type="checkbox">
            </label>
            <label class="field inline short">
              <span>Overwrite existing tags</span>
              <input id="cfg-music-meta-overwrite" type="checkbox">
            </label>
            <label class="field short">
              <span>Max artwork size (px)</span>
              <input id="cfg-music-meta-artwork-size" type="number" min="200" step="50">
            </label>
            <label class="field short">
              <span>Rate limit (seconds)</span>
              <input id="cfg-music-meta-rate" type="number" min="0" step="0.1">
            </label>
            <label class="field inline short">
              <span>Dry-run tagging</span>
              <input id="cfg-music-meta-dry-run" type="checkbox">
            </label>
          </div>
          <div class="notice">Applies only to music mode runs. Enrichment happens after downloads, in the background.</div>
        </div>

        <div class="group">
          <div class="group-title">Accounts</div>
          <div id="accounts-list" class="stack"></div>
          <button id="add-account" class="button ghost">Add account</button>
        </div>

        <div class="group">
          <div class="group-title">Playlists</div>
          <div id="playlists-list" class="stack"></div>
          <button id="add-playlist" class="button ghost">Add playlist</button>
        </div>

        <div class="group">
          <div class="group-title">Spotify Playlists</div>
          <div id="spotify-playlists-list" class="stack"></div>
        </div>

        <div class="group">
          <div class="group-title">Spotify Integration</div>
          <div class="grid two">
            <label class="field full" for="spotify-client-id">
              <span>Client ID</span>
              <input id="spotify-client-id" type="text">
            </label>
            <label class="field full" for="spotify-client-secret">
              <span>Client Secret</span>
              <input id="spotify-client-secret" type="text">
            </label>
            <label class="field full" for="spotify-redirect-uri">
              <span>Redirect URI</span>
              <input id="spotify-redirect-uri" type="text" readonly>
            </label>
          </div>
          <div class="row">
            <span class="label">Connection Status</span>
            <span id="spotify-connection-status">Not connected</span>
          </div>
          <div class="row">
            <button id="spotify-connect-btn" class="button" type="button">Connect Spotify</button>
            <button id="spotify-disconnect-btn" class="button ghost" type="button" style="display: none;">Disconnect</button>
          </div>
          <div class="grid two">
            <label class="field inline short">
              <span>Sync Liked Songs</span>
              <input id="spotify-sync-liked" type="checkbox">
            </label>
            <label class="field short">
              <span>Liked Songs interval (minutes)</span>
              <input id="spotify-liked-interval" type="number" min="1" step="1">
            </label>
            <label class="field inline short">
              <span>Sync Saved Albums</span>
              <input id="spotify-sync-saved" type="checkbox">
            </label>
            <label class="field short">
              <span>Saved Albums interval (minutes)</span>
              <input id="spotify-saved-interval" type="number" min="1" step="1">
            </label>
            <label class="field inline short">
              <span>Sync My Playlists</span>
              <input id="spotify-sync-playlists" type="checkbox">
            </label>
            <label class="field short">
              <span>Playlists interval (minutes)</span>
              <input id="spotify-playlists-interval" type="number" min="1" step="1">
            </label>
          </div>
          <label class="field full" for="config-spotify-playlists">
            <span>Spotify Playlists (one per line)</span>
            <textarea id="config-spotify-playlists" rows="4"></textarea>
          </label>
        </div>

        <div class="group">
          <div class="group-title">yt-dlp Options (JSON)</div>
          <label class="field full">
            <span>Options</span>
            <textarea id="cfg-yt-dlp-opts" rows="6" placeholder='{"format_sort": ["res", "codec"]}'></textarea>
          </label>
        </div>

        <div class="group">
          <div class="group-title">Maintenance</div>
          <div class="row">
            <button id="ytdlp-update" class="button ghost">Update yt-dlp</button>
            <div id="ytdlp-update-message" class="notice" role="status"></div>
          </div>
        </div>

        <div class="row">
          <button id="save-config" class="button">Save Config</button>
          <button id="reset-config" class="button ghost">Reset</button>
          <div id="config-message" class="notice" role="status"></div>
        </div>
      </div>
    </section>

    <section class="panel" id="search-items-panel" data-page="advanced">
      <div class="panel-title">Search Items & Candidates</div>
      <div class="notice">Selected request: <span id="search-selected-request">-</span></div>
      <div class="group">
        <div class="group-title">Items</div>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Item ID</th>
                <th>Position</th>
                <th>Artist / Album / Track</th>
                <th>Status</th>
                <th>Chosen source</th>
                <th>Chosen score</th>
              </tr>
            </thead>
            <tbody id="search-items-body"></tbody>
          </table>
        </div>
      </div>
      <div class="group">
        <div class="group-title">Candidates</div>
        <div class="notice">Selected item: <span id="search-selected-item">-</span></div>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Source</th>
                <th>Canonical</th>
                <th>Artwork</th>
                <th>Source title</th>
                <th>Duration</th>
                <th>Final score</th>
                <th>Rank</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="search-candidates-body"></tbody>
          </table>
        </div>
      </div>
    </section>


    <section class="panel" id="search-requests-panel" data-page="advanced">
      <div class="panel-title">Search Requests</div>
      <div class="row">
        <button id="search-requests-refresh" class="button ghost">Refresh</button>
        <button id="search-requests-sort" class="button ghost">Sort: Newest</button>
        <div id="search-requests-message" class="notice" role="status"></div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Request ID</th>
              <th>Artist / Album / Track</th>
              <th>Intent</th>
              <th>Status</th>
              <th>Created</th>
              <th>Error</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="search-requests-body"></tbody>
        </table>
      </div>
    </section>

    

    

    <section class="panel" id="search-queue-panel" data-page="advanced">
      <div class="panel-title">Unified Download Queue</div>
      <div class="row">
        <label class="field inline short">
          <span>Limit</span>
          <input id="search-queue-limit" type="number" min="1" max="5000" value="100">
        </label>
        <button id="search-queue-refresh" class="button ghost">Refresh</button>
        <div id="search-queue-message" class="notice" role="status"></div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Job ID</th>
              <th>Origin</th>
              <th>Source</th>
              <th>Media intent</th>
              <th>Status</th>
              <th>Attempts</th>
              <th>Created</th>
              <th>Last error</th>
            </tr>
          </thead>
          <tbody id="search-queue-body"></tbody>
        </table>
      </div>
    </section>

    <section class="panel full page-full" id="logs-panel" data-page="status">
      <div class="panel-title">Logs</div>
      <div class="row">
        <label class="field inline short">
          <span>Lines</span>
          <input id="logs-lines" type="number" min="1" max="5000" value="200">
        </label>
        <button id="logs-refresh" class="button ghost">Refresh</button>
        <label class="field inline">
          <span>Auto</span>
          <input id="logs-auto" type="checkbox" checked>
        </label>
      </div>
      <pre id="logs-output" class="log-output" aria-live="polite"></pre>
    </section>

    <section class="panel full page-full" id="downloads-panel" data-page="status">
      <div class="panel-title">Downloads</div>
      <div class="row">
        <button id="downloads-refresh" class="button ghost">Refresh</button>
        <button id="cleanup-temp" class="button ghost">Clear temporary files</button>
        <div id="downloads-message" class="notice" role="status"></div>
      </div>
      <div class="row">
        <button class="button ghost small filters-toggle" data-target="downloads-filters" type="button">Filters</button>
      </div>
      <div class="filters-block" id="downloads-filters">
        <div class="row filters">
          <label class="field inline long">
            <span>Search</span>
            <input id="downloads-search" type="text" placeholder="name or path">
          </label>
          <label class="field inline short">
            <span>Limit</span>
            <input id="downloads-limit" type="number" min="1" max="5000" value="50">
          </label>
          <button id="downloads-apply" class="button ghost">Apply</button>
          <button id="downloads-clear" class="button ghost">Clear</button>
        </div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Modified</th>
              <th>Size</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="downloads-body"></tbody>
        </table>
      </div>
    </section>

    <section class="panel full page-full" id="history-panel" data-page="status">
      <div class="panel-title">History</div>
      <div class="row">
        <button class="button ghost small filters-toggle" data-target="history-filters" type="button">Filters</button>
        <button id="history-refresh" class="button ghost">Refresh</button>
      </div>
      <div class="filters-block" id="history-filters">
        <div class="row filters">
          <label class="field inline long">
            <span>Search</span>
            <input id="history-search" type="text" placeholder="title or filename">
          </label>
          <label class="field inline medium">
            <span>Playlist</span>
            <input id="history-playlist" type="text" placeholder="playlist id">
          </label>
          <label class="field inline short">
            <span>From</span>
            <input id="history-from" type="date">
          </label>
          <label class="field inline short">
            <span>To</span>
            <input id="history-to" type="date">
          </label>
        </div>
        <div class="row filters">
          <label class="field inline short">
            <span>Limit</span>
            <input id="history-limit" type="number" min="1" max="5000" value="50">
          </label>
          <label class="field inline short">
            <span>Sort</span>
            <select id="history-sort">
              <option value="date">date</option>
              <option value="title">title</option>
              <option value="size">size</option>
            </select>
          </label>
          <label class="field inline short">
            <span>Dir</span>
            <select id="history-dir">
              <option value="desc">desc</option>
              <option value="asc">asc</option>
            </select>
          </label>
          <label class="field inline short">
            <span>Internal paths</span>
            <input id="history-show-paths" type="checkbox">
          </label>
          <button id="history-apply" class="button ghost">Apply</button>
          <button id="history-clear" class="button ghost">Clear</button>
        </div>
      </div>
      <div id="history-message" class="notice" role="status"></div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Video ID</th>
              <th>Playlist ID</th>
              <th>Downloaded At</th>
              <th>Filepath</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="history-body"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="browser-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="browser-title">
    <div class="modal-card">
      <div class="row space-between">
        <div id="browser-title" class="panel-title">Server Browser</div>
        <button id="browser-close" class="button ghost small">Close</button>
      </div>
      <div class="row space-between">
        <div class="meta" id="browser-path">/</div>
        <button id="browser-up" class="button ghost small">Up</button>
      </div>
      <div id="browser-list" class="browser-list"></div>
      <div class="row space-between">
        <div class="meta" id="browser-selected">No selection</div>
        <button id="browser-select" class="button small">Use this path</button>
      </div>
    </div>
  </div>

  <div id="oauth-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="oauth-title">
    <div class="modal-card">
      <div class="row space-between">
        <div id="oauth-title" class="panel-title">OAuth Helper</div>
        <button id="oauth-close" class="button ghost small">Close</button>
      </div>
      <div class="stack">
        <div class="notice">Open the authorization URL, approve access, then paste the code below.</div>
        <div class="row">
          <span class="label">Account</span>
          <span id="oauth-account" class="meta">-</span>
        </div>
        <label class="field long">
          <span>Authorization URL</span>
          <div class="row">
            <input id="oauth-url" type="text" readonly>
            <button id="oauth-open" class="button ghost small" type="button">Open</button>
          </div>
        </label>
        <label class="field medium">
          <span>Authorization code</span>
          <input id="oauth-code" type="text" placeholder="Paste the code here">
        </label>
        <div class="row">
          <button id="oauth-complete" class="button">Complete OAuth</button>
          <div id="oauth-message" class="notice" role="status"></div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
